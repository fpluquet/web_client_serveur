<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DÃ©monstration - Stockage cÃ´tÃ© Client</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #f5f5f5;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .demo-section {
      margin-bottom: 40px;
      padding: 20px;
      border: 1px solid #ddd;
      border-radius: 8px;
      background: #fafafa;
    }
    .demo-section h2 {
      margin-top: 0;
      color: #333;
      border-bottom: 2px solid #007bff;
      padding-bottom: 10px;
    }
    .form-group {
      margin-bottom: 15px;
    }
    label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }
    input, textarea, select {
      width: 100%;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      box-sizing: border-box;
    }
    button {
      background: #007bff;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 4px;
      cursor: pointer;
      margin-right: 10px;
      margin-bottom: 10px;
    }
    button:hover {
      background: #0056b3;
    }
    button.danger {
      background: #dc3545;
    }
    button.danger:hover {
      background: #c82333;
    }
    .output {
      background: #e9ecef;
      border: 1px solid #ced4da;
      border-radius: 4px;
      padding: 10px;
      margin-top: 10px;
      white-space: pre-wrap;
      max-height: 200px;
      overflow-y: auto;
    }
    .storage-info {
      background: #d1ecf1;
      border: 1px solid #bee5eb;
      border-radius: 4px;
      padding: 10px;
      margin-top: 10px;
    }
    .grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }
    .auto-save-status {
      color: #28a745;
      font-style: italic;
    }
    @media (max-width: 768px) {
      .grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ—ƒï¸ DÃ©monstration des Types de Stockage CÃ´tÃ© Client</h1>
    <p>Cette page vous permet de tester et comprendre les diffÃ©rents mÃ©canismes de stockage disponibles dans le navigateur.</p>
    
    <div class="grid">
      <!-- localStorage Demo -->
      <div class="demo-section">
        <h2>ğŸ“¦ localStorage</h2>
        <p><strong>Persistance :</strong> Permanente jusqu'Ã  suppression manuelle</p>
        <p><strong>PortÃ©e :</strong> Tous les onglets du mÃªme domaine</p>
        
        <div class="form-group">
          <label for="ls-key">ClÃ© :</label>
          <input type="text" id="ls-key" value="ma-preference" placeholder="Nom de la clÃ©">
        </div>
        <div class="form-group">
          <label for="ls-value">Valeur :</label>
          <input type="text" id="ls-value" placeholder="Valeur Ã  stocker">
        </div>
        
        <button onclick="localStorage_save()">ğŸ’¾ Sauvegarder</button>
        <button onclick="localStorage_load()">ğŸ“– Charger</button>
        <button onclick="localStorage_delete()" class="danger">ğŸ—‘ï¸ Supprimer</button>
        <button onclick="localStorage_listAll()">ğŸ“‹ Lister tout</button>
        <button onclick="localStorage_clear()" class="danger">ğŸ§¹ Tout vider</button>
        
        <div class="output" id="ls-output">RÃ©sultat des opÃ©rations localStorage...</div>
      </div>

      <!-- sessionStorage Demo -->
      <div class="demo-section">
        <h2>ğŸ·ï¸ sessionStorage</h2>
        <p><strong>Persistance :</strong> Jusqu'Ã  fermeture de l'onglet</p>
        <p><strong>PortÃ©e :</strong> Onglet actuel uniquement</p>
        
        <div class="form-group">
          <label for="ss-key">ClÃ© :</label>
          <input type="text" id="ss-key" value="session-data" placeholder="Nom de la clÃ©">
        </div>
        <div class="form-group">
          <label for="ss-value">Valeur :</label>
          <input type="text" id="ss-value" placeholder="Valeur Ã  stocker">
        </div>
        
        <button onclick="sessionStorage_save()">ğŸ’¾ Sauvegarder</button>
        <button onclick="sessionStorage_load()">ğŸ“– Charger</button>
        <button onclick="sessionStorage_delete()" class="danger">ğŸ—‘ï¸ Supprimer</button>
        <button onclick="sessionStorage_listAll()">ğŸ“‹ Lister tout</button>
        <button onclick="sessionStorage_clear()" class="danger">ğŸ§¹ Tout vider</button>
        
        <div class="output" id="ss-output">RÃ©sultat des opÃ©rations sessionStorage...</div>
      </div>
    </div>

    <!-- Cookies Demo -->
    <div class="demo-section">
      <h2>ğŸª Cookies</h2>
      <p><strong>Persistance :</strong> Configurable (session ou expiration)</p>
      <p><strong>Envoi :</strong> Automatiquement envoyÃ©s avec chaque requÃªte HTTP</p>
      
      <div class="grid">
        <div>
          <div class="form-group">
            <label for="cookie-name">Nom :</label>
            <input type="text" id="cookie-name" value="mon-cookie" placeholder="Nom du cookie">
          </div>
          <div class="form-group">
            <label for="cookie-value">Valeur :</label>
            <input type="text" id="cookie-value" placeholder="Valeur du cookie">
          </div>
          <div class="form-group">
            <label for="cookie-expiry">Expiration :</label>
            <select id="cookie-expiry">
              <option value="session">Session (fermeture navigateur)</option>
              <option value="1hour">1 heure</option>
              <option value="1day">1 jour</option>
              <option value="1week">1 semaine</option>
            </select>
          </div>
        </div>
        <div>
          <button onclick="cookie_save()">ğŸ’¾ CrÃ©er Cookie</button>
          <button onclick="cookie_load()">ğŸ“– Lire Cookie</button>
          <button onclick="cookie_delete()" class="danger">ğŸ—‘ï¸ Supprimer Cookie</button>
          <button onclick="cookie_listAll()">ğŸ“‹ Lister tous les Cookies</button>
          
          <div class="output" id="cookie-output">RÃ©sultat des opÃ©rations cookies...</div>
        </div>
      </div>
    </div>

    <!-- Auto-save Demo -->
    <div class="demo-section">
      <h2>âœï¸ DÃ©monstration : Sauvegarde Automatique</h2>
      <p>Ce formulaire utilise localStorage pour sauvegarder automatiquement vos modifications.</p>
      
      <div class="form-group">
        <label for="auto-title">Titre de l'article :</label>
        <input type="text" id="auto-title" placeholder="Tapez votre titre...">
        <div class="auto-save-status" id="title-status"></div>
      </div>
      
      <div class="form-group">
        <label for="auto-content">Contenu :</label>
        <textarea id="auto-content" rows="6" placeholder="Commencez Ã  taper votre article..."></textarea>
        <div class="auto-save-status" id="content-status"></div>
      </div>
      
      <button onclick="clearAutoSave()" class="danger">ğŸ—‘ï¸ Effacer le brouillon</button>
      <button onclick="publishArticle()">ğŸ“¤ Publier l'article</button>
      
      <div class="storage-info">
        <strong>ğŸ’¡ Astuce :</strong> Tapez du texte, rafraÃ®chissez la page (F5) ou fermez/rouvrez l'onglet. 
        Votre texte sera automatiquement restaurÃ© grÃ¢ce Ã  localStorage !
      </div>
    </div>

    <!-- Storage Comparison -->
    <div class="demo-section">
      <h2>ğŸ“Š Comparaison en Temps RÃ©el</h2>
      <p>Testez le comportement de chaque type de stockage :</p>
      
      <div class="form-group">
        <label for="test-data">DonnÃ©es de test :</label>
        <input type="text" id="test-data" value="Test de persistance" placeholder="DonnÃ©es Ã  tester">
      </div>
      
      <button onclick="saveToAll()">ğŸ’¾ Sauvegarder dans TOUS les types</button>
      <button onclick="loadFromAll()">ğŸ“– Charger depuis TOUS les types</button>
      <button onclick="clearAll()" class="danger">ğŸ§¹ Tout supprimer</button>
      
      <div class="output" id="comparison-output">Cliquez sur les boutons pour voir les diffÃ©rences...</div>
      
      <div class="storage-info">
        <strong>ğŸ§ª ExpÃ©rience :</strong>
        <ol>
          <li>Sauvegardez des donnÃ©es dans tous les types</li>
          <li>RafraÃ®chissez la page (F5) â†’ localStorage et cookies persistent</li>
          <li>Ouvrez un nouvel onglet vers cette page â†’ seuls localStorage et cookies sont partagÃ©s</li>
          <li>Fermez tous les onglets et rouvrez â†’ seuls localStorage et cookies (non-session) persistent</li>
        </ol>
      </div>
    </div>

    <!-- Storage Info -->
    <div class="demo-section">
      <h2>ğŸ“ˆ Informations sur le Stockage</h2>
      <button onclick="getStorageInfo()">ğŸ” Analyser le stockage</button>
      <div class="output" id="storage-info-output">Cliquez pour obtenir des informations sur le stockage...</div>
    </div>
  </div>

  <script>
    // ======================
    // localStorage Functions
    // ======================
    function localStorage_save() {
      const key = document.getElementById('ls-key').value;
      const value = document.getElementById('ls-value').value;
      
      if (!key || !value) {
        output('ls-output', 'âŒ Veuillez remplir la clÃ© et la valeur');
        return;
      }
      
      try {
        localStorage.setItem(key, value);
        output('ls-output', `âœ… SauvegardÃ©: "${key}" = "${value}"`);
      } catch (error) {
        output('ls-output', `âŒ Erreur: ${error.message}`);
      }
    }

    function localStorage_load() {
      const key = document.getElementById('ls-key').value;
      
      if (!key) {
        output('ls-output', 'âŒ Veuillez spÃ©cifier une clÃ©');
        return;
      }
      
      const value = localStorage.getItem(key);
      if (value !== null) {
        document.getElementById('ls-value').value = value;
        output('ls-output', `âœ… ChargÃ©: "${key}" = "${value}"`);
      } else {
        output('ls-output', `âŒ ClÃ© "${key}" non trouvÃ©e`);
      }
    }

    function localStorage_delete() {
      const key = document.getElementById('ls-key').value;
      
      if (!key) {
        output('ls-output', 'âŒ Veuillez spÃ©cifier une clÃ©');
        return;
      }
      
      localStorage.removeItem(key);
      output('ls-output', `âœ… SupprimÃ©: "${key}"`);
    }

    function localStorage_listAll() {
      const items = [];
      for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        const value = localStorage.getItem(key);
        items.push(`"${key}": "${value}"`);
      }
      
      if (items.length === 0) {
        output('ls-output', 'ğŸ“­ localStorage est vide');
      } else {
        output('ls-output', `ğŸ“‹ localStorage contient ${items.length} Ã©lÃ©ment(s):\n${items.join('\n')}`);
      }
    }

    function localStorage_clear() {
      const count = localStorage.length;
      localStorage.clear();
      output('ls-output', `ğŸ§¹ localStorage vidÃ© (${count} Ã©lÃ©ments supprimÃ©s)`);
    }

    // =========================
    // sessionStorage Functions
    // =========================
    function sessionStorage_save() {
      const key = document.getElementById('ss-key').value;
      const value = document.getElementById('ss-value').value;
      
      if (!key || !value) {
        output('ss-output', 'âŒ Veuillez remplir la clÃ© et la valeur');
        return;
      }
      
      try {
        sessionStorage.setItem(key, value);
        output('ss-output', `âœ… SauvegardÃ©: "${key}" = "${value}"`);
      } catch (error) {
        output('ss-output', `âŒ Erreur: ${error.message}`);
      }
    }

    function sessionStorage_load() {
      const key = document.getElementById('ss-key').value;
      
      if (!key) {
        output('ss-output', 'âŒ Veuillez spÃ©cifier une clÃ©');
        return;
      }
      
      const value = sessionStorage.getItem(key);
      if (value !== null) {
        document.getElementById('ss-value').value = value;
        output('ss-output', `âœ… ChargÃ©: "${key}" = "${value}"`);
      } else {
        output('ss-output', `âŒ ClÃ© "${key}" non trouvÃ©e`);
      }
    }

    function sessionStorage_delete() {
      const key = document.getElementById('ss-key').value;
      
      if (!key) {
        output('ss-output', 'âŒ Veuillez spÃ©cifier une clÃ©');
        return;
      }
      
      sessionStorage.removeItem(key);
      output('ss-output', `âœ… SupprimÃ©: "${key}"`);
    }

    function sessionStorage_listAll() {
      const items = [];
      for (let i = 0; i < sessionStorage.length; i++) {
        const key = sessionStorage.key(i);
        const value = sessionStorage.getItem(key);
        items.push(`"${key}": "${value}"`);
      }
      
      if (items.length === 0) {
        output('ss-output', 'ğŸ“­ sessionStorage est vide');
      } else {
        output('ss-output', `ğŸ“‹ sessionStorage contient ${items.length} Ã©lÃ©ment(s):\n${items.join('\n')}`);
      }
    }

    function sessionStorage_clear() {
      const count = sessionStorage.length;
      sessionStorage.clear();
      output('ss-output', `ğŸ§¹ sessionStorage vidÃ© (${count} Ã©lÃ©ments supprimÃ©s)`);
    }

    // ===================
    // Cookies Functions
    // ===================
    function cookie_save() {
      const name = document.getElementById('cookie-name').value;
      const value = document.getElementById('cookie-value').value;
      const expiry = document.getElementById('cookie-expiry').value;
      
      if (!name || !value) {
        output('cookie-output', 'âŒ Veuillez remplir le nom et la valeur');
        return;
      }
      
      let expiryString = '';
      if (expiry !== 'session') {
        const expiryDate = new Date();
        switch (expiry) {
          case '1hour':
            expiryDate.setHours(expiryDate.getHours() + 1);
            break;
          case '1day':
            expiryDate.setDate(expiryDate.getDate() + 1);
            break;
          case '1week':
            expiryDate.setDate(expiryDate.getDate() + 7);
            break;
        }
        expiryString = `; expires=${expiryDate.toUTCString()}`;
      }
      
      document.cookie = `${name}=${value}${expiryString}; path=/`;
      output('cookie-output', `âœ… Cookie crÃ©Ã©: "${name}" = "${value}" (${expiry === 'session' ? 'session' : expiry})`);
    }

    function cookie_load() {
      const name = document.getElementById('cookie-name').value;
      
      if (!name) {
        output('cookie-output', 'âŒ Veuillez spÃ©cifier un nom de cookie');
        return;
      }
      
      const value = getCookie(name);
      if (value !== null) {
        document.getElementById('cookie-value').value = value;
        output('cookie-output', `âœ… Cookie lu: "${name}" = "${value}"`);
      } else {
        output('cookie-output', `âŒ Cookie "${name}" non trouvÃ©`);
      }
    }

    function cookie_delete() {
      const name = document.getElementById('cookie-name').value;
      
      if (!name) {
        output('cookie-output', 'âŒ Veuillez spÃ©cifier un nom de cookie');
        return;
      }
      
      document.cookie = `${name}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/`;
      output('cookie-output', `âœ… Cookie supprimÃ©: "${name}"`);
    }

    function cookie_listAll() {
      const cookies = document.cookie.split(';');
      const cookieList = [];
      
      cookies.forEach(cookie => {
        const trimmed = cookie.trim();
        if (trimmed) {
          const [name, value] = trimmed.split('=');
          cookieList.push(`"${name}": "${value || ''}"`);
        }
      });
      
      if (cookieList.length === 0) {
        output('cookie-output', 'ğŸ“­ Aucun cookie trouvÃ©');
      } else {
        output('cookie-output', `ğŸª ${cookieList.length} cookie(s) trouvÃ©(s):\n${cookieList.join('\n')}`);
      }
    }

    // ======================
    // Auto-save Functions
    // ======================
    function initAutoSave() {
      const titleInput = document.getElementById('auto-title');
      const contentInput = document.getElementById('auto-content');
      
      // Restaurer les donnÃ©es sauvegardÃ©es
      const savedTitle = localStorage.getItem('draft-title');
      const savedContent = localStorage.getItem('draft-content');
      
      if (savedTitle) {
        titleInput.value = savedTitle;
        showStatus('title-status', 'âœ… Titre restaurÃ© depuis le localStorage');
      }
      
      if (savedContent) {
        contentInput.value = savedContent;
        showStatus('content-status', 'âœ… Contenu restaurÃ© depuis le localStorage');
      }
      
      // Sauvegarder automatiquement
      titleInput.addEventListener('input', () => {
        localStorage.setItem('draft-title', titleInput.value);
        showStatus('title-status', 'ğŸ’¾ Titre sauvegardÃ© automatiquement');
      });
      
      contentInput.addEventListener('input', () => {
        localStorage.setItem('draft-content', contentInput.value);
        showStatus('content-status', 'ğŸ’¾ Contenu sauvegardÃ© automatiquement');
      });
    }

    function clearAutoSave() {
      localStorage.removeItem('draft-title');
      localStorage.removeItem('draft-content');
      document.getElementById('auto-title').value = '';
      document.getElementById('auto-content').value = '';
      showStatus('title-status', 'ğŸ—‘ï¸ Brouillon supprimÃ©');
      showStatus('content-status', 'ğŸ—‘ï¸ Brouillon supprimÃ©');
    }

    function publishArticle() {
      const title = document.getElementById('auto-title').value;
      const content = document.getElementById('auto-content').value;
      
      if (!title || !content) {
        alert('âŒ Veuillez remplir le titre et le contenu');
        return;
      }
      
      // Simuler la publication
      alert(`ğŸ“¤ Article "${title}" publiÃ© avec succÃ¨s!`);
      
      // Nettoyer les brouillons aprÃ¨s publication
      clearAutoSave();
    }

    // =======================
    // Comparison Functions
    // =======================
    function saveToAll() {
      const data = document.getElementById('test-data').value;
      const timestamp = new Date().toLocaleTimeString();
      const testValue = `${data} (${timestamp})`;
      
      // localStorage
      localStorage.setItem('test-comparison', testValue);
      
      // sessionStorage
      sessionStorage.setItem('test-comparison', testValue);
      
      // Cookie
      document.cookie = `test-comparison=${testValue}; path=/`;
      
      output('comparison-output', `âœ… DonnÃ©es sauvegardÃ©es dans tous les types:\n"${testValue}"`);
    }

    function loadFromAll() {
      const results = [];
      
      // localStorage
      const lsValue = localStorage.getItem('test-comparison');
      results.push(`ğŸ“¦ localStorage: ${lsValue || 'non trouvÃ©'}`);
      
      // sessionStorage
      const ssValue = sessionStorage.getItem('test-comparison');
      results.push(`ğŸ·ï¸ sessionStorage: ${ssValue || 'non trouvÃ©'}`);
      
      // Cookie
      const cookieValue = getCookie('test-comparison');
      results.push(`ğŸª Cookie: ${cookieValue || 'non trouvÃ©'}`);
      
      output('comparison-output', results.join('\n'));
    }

    function clearAll() {
      localStorage.removeItem('test-comparison');
      sessionStorage.removeItem('test-comparison');
      document.cookie = 'test-comparison=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/';
      
      output('comparison-output', 'ğŸ§¹ Toutes les donnÃ©es de test supprimÃ©es');
    }

    // ====================
    // Storage Info
    // ====================
    async function getStorageInfo() {
      let info = [];
      
      // Compter les Ã©lÃ©ments
      info.push(`ğŸ“¦ localStorage: ${localStorage.length} Ã©lÃ©ment(s)`);
      info.push(`ğŸ·ï¸ sessionStorage: ${sessionStorage.length} Ã©lÃ©ment(s)`);
      
      // Cookies
      const cookieCount = document.cookie ? document.cookie.split(';').length : 0;
      info.push(`ğŸª Cookies: ${cookieCount} Ã©lÃ©ment(s)`);
      
      // Estimation de l'usage du stockage (API expÃ©rimentale)
      if ('storage' in navigator && 'estimate' in navigator.storage) {
        try {
          const estimate = await navigator.storage.estimate();
          const usedMB = (estimate.usage / 1024 / 1024).toFixed(2);
          const quotaMB = (estimate.quota / 1024 / 1024).toFixed(2);
          const percentage = ((estimate.usage / estimate.quota) * 100).toFixed(2);
          
          info.push('');
          info.push('ğŸ“Š Estimation de l\'usage du stockage:');
          info.push(`   UtilisÃ©: ${usedMB} MB`);
          info.push(`   Quota: ${quotaMB} MB`);
          info.push(`   Pourcentage: ${percentage}%`);
        } catch (error) {
          info.push('');
          info.push('âš ï¸ Estimation du stockage non disponible');
        }
      }
      
      // Support des APIs
      info.push('');
      info.push('ğŸ”§ Support des APIs:');
      info.push(`   localStorage: ${typeof(Storage) !== 'undefined' ? 'âœ…' : 'âŒ'}`);
      info.push(`   sessionStorage: ${typeof(Storage) !== 'undefined' ? 'âœ…' : 'âŒ'}`);
      info.push(`   IndexedDB: ${!!window.indexedDB ? 'âœ…' : 'âŒ'}`);
      info.push(`   Cache API: ${!!window.caches ? 'âœ…' : 'âŒ'}`);
      
      output('storage-info-output', info.join('\n'));
    }

    // ===================
    // Utility Functions
    // ===================
    function output(elementId, text) {
      document.getElementById(elementId).textContent = text;
    }

    function showStatus(elementId, text) {
      const element = document.getElementById(elementId);
      element.textContent = text;
      // Effacer le message aprÃ¨s 3 secondes
      setTimeout(() => {
        element.textContent = '';
      }, 3000);
    }

    function getCookie(name) {
      const value = `; ${document.cookie}`;
      const parts = value.split(`; ${name}=`);
      if (parts.length === 2) {
        return parts.pop().split(';').shift();
      }
      return null;
    }

    // ===================
    // Page Initialization
    // ===================
    document.addEventListener('DOMContentLoaded', () => {
      initAutoSave();
      
      // Afficher un message de bienvenue
      const hasVisited = localStorage.getItem('demo-visited');
      if (!hasVisited) {
        localStorage.setItem('demo-visited', 'true');
        localStorage.setItem('first-visit', new Date().toLocaleString());
        alert('ğŸ‘‹ Bienvenue ! Cette page va vous aider Ã  comprendre le stockage cÃ´tÃ© client.\n\nCommencez par la section localStorage, puis explorez les autres types de stockage.');
      } else {
        const firstVisit = localStorage.getItem('first-visit');
        console.log(`ğŸ”„ Visite de retour ! PremiÃ¨re visite: ${firstVisit}`);
      }
    });
  </script>
</body>
</html>